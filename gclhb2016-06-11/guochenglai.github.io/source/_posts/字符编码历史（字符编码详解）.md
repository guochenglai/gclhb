---
title: 字符编码历史（字符编码详解）
toc: true
mathjax: true
date: 2016-06-03 20:06:48
categories: 字符编码
tags: 字符编码
description: 简单来说字符集就是一套文字符号及其编码的描述。从20世纪60年代美国标准化组织ANSI发布了第一个计算机字符集ASCII开始，为了处理不同的文字，各大计算机公司，各国政府，以及各种标准化组织发明了几百种字符集，例如我们所熟悉的：ASCII，USC，GBK，BIG5... 这些不同的字符集从收录到编码都各不相同，给软件的移植和信息的交换带来了很大的困惑。最严重的问题就是字符乱码，这也是到现在为止还影响着每个开发人员的根本问题。本文将从字符编码的发展历史为主线，分析字符乱码的缘由，以及精彩的字符编码斗争史。
---

## 字符集概述
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;简单来说字符集就是一套文字符号及其编码的描述。从20世纪60年代美国标准化组织ANSI发布了第一个计算机字符集ASCII开始，为了处理不同的文字，各大计算机公司，各国政府，以及各种标准化组织发明了几百种字符集，例如我们所熟悉的：ASCII，USC，GBK，BIG5... 这些不同的字符集从收录到编码都各不相同，给软件的移植和信息的交换带来了很大的困惑。最严重的问题就是字符乱码，这也是到现在为止还影响着每个开发人员的根本问题。本文将从字符编码的发展历史为主线，分析字符乱码的缘由，以及精彩的字符编码斗争史。
### 几个基本概念
- 位：计算机的最小单位 二进制中的一位 用二进制的0/1表示
- 字节：八个位组成一个字节。
- 字符：我们肉眼可见的文字与符号。
- 字符集：字符的集合。
- 编码：将字符转换成计算机可识别的0/1代码。
- 解码：将计算机表示的0/1编码转换成肉眼可见的字符。
- 大端序(小端序)：Big Endian/Little Endian 在UCS-2编码中，采用的是两个字节进行编码，那么对于同一份编码就会有两个不同的理解，如果认为高字节在前，低字节在后，会解码出一种字符表现实现，反之会解码出另外一种字符表现形式。所以就需要一种方式能够标识字符编码的顺序，大端序就是表示高字节在前，低字节在后。小端序就是表示低字节在前，高字节在后。
- BOM(Byte Order Market)：微软的文本编辑器在处理字符顺序的时候，为了标识该文件是大端序，还是小端序，就在文件的开头添加了一个不存在（宽度为0）的字符标识改文件是大端序还是小端序。oxfeff表示大端序，oxfffe表示小端序。
- BMP(Basic MultiLanguage Plain)：基本多语言平面，UCS-4编码中的0组0面，用来兼容Unicode组织的二字节编码。
- UCS（Universal Coded Character Set）：IOS组织为统一字符编码问题，而推出的一种编码规范。
- Unicode：统一字符编码，是美国的一些大公司的联盟组织，推出的一种编码规范，用来对抗UCS，后来二者达成一致。很多人区分不了UCS和Unicode就是因为，后来二者虽然分开发布，但是规范都是一致的。 它的官方定义为：Unicode字符集是一种在计算机上使用的字符集。它为每种语言中的每个字符设定了统一而且唯一的二进制编码，以满足跨语言、跨平台进行文本转换、处理的要求。
## 第一阶段：字符编码的起源
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在第一代计算机发明的时候就确定了以二进制方式存储数据的基本逻辑，所以我们所见的所有信息，要想持久化就必须转换成计算机可识别的二进制编码。所以就必须建立一套字符对应二进制的对应关系。所以美国国家标准协会（American National Standard Institution）就收集了当时美国所使用的所有字符（一共128个）采用8个二进制位来建立了字符和对应的二进制编码的对应关系：
```          
0000 0000-0001 1111 共33种状态表示特殊的终端控制（例如打印机响铃）（0-33）
0011 0000-0011 1010 共10个表示0-9十个字母
0100 0001-0101 1010 共26个表示大写字母
0110 0001-0111 1010 共26个表示小写字母
   外加33个符号
   一共128个占7位 高位补0 所以共8位，也就是说一个字符占用一个字节
```
## 第二阶段：字符编码的发展
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;计算机迅速发展并传入了欧亚，所以每个国家都面临着字符以及字符对应的二进制转换问题。下面将分析在这个发展阶段，比较典型的两种字符。
### EASCII
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;计算机传入欧洲之后。当时欧洲国家的字符组成基本是：英文字母+本国特有字符，所以西欧的一些国家就联合起来，将ASCII的最高位利用起来（128-255）之间的数字进行编码，用来表示本国特有字符，进行了统一编码。所以EASCII还是单字节编码
### GBK
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当计算机传出到中国之后，国家也面临字符编码相关的工作，所以当时就推动制定了一套双字节编码编码规范，他收录了常见的6000多个中文、东亚文字以及欧美文字，所有的字母采用两个字节进行编码，称为GBK，由于微软等公司的支持，所以GBK在中国很流行，以至于现在的很多小企业还是采用GBK编码。
## 字符乱码
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当计算机只是在本地（使用一种字符编码的范围内的地区）使用和传播的时候不会出现什么问题，但是当不用的区域需要进行信息交换的时候就会出现问题，比如中国和欧洲进行字符交换，中国使用GBK编码，欧洲使用EASCII编码。那么会出现这样一种情况，一个中国的汉字，被显示为连个奇怪的西欧字符，看到上面的历史，应该明白原因了吧。
## 第三阶段：天下一统
### UCS系列
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;随着信息交流越来越频繁。字符乱码的问题也就越来越突出，统一编码的需求也就越来越强烈。所以IOS组织就提出了一个统一的编码方案。大致的规则如下：
- 所有的字符采用四个字节进行编码。
- 将整个编码空间划分为（组，面，行，列）四个部分，并且最高位固定为0，所以一共可以表达的字符个数为 128\*255\*255\*255 总共可以表示2亿多个字符。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;因为当时采用了四字节的编码方式，所以这种编码方式又称为 UCS-4。

### unicode系列
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UCS-4编码推出之后遭受到了美国的大公司的反对，当时由施乐公司牵头，联合了Google、Micro Soft、IBM、Oracle、SUN、Apple等公司成立了Unicode委员会，研发自己的编码和解码规范，然后推出了Unicode1.0编码规范。Unicode1.0采用双字节编码，收录了世界上大部分常用的字符。在这段时间就出现了两个不同的规范。ios和Unicode组织也意识到了这个问题的严重性，于是两者开始对话。最终的结果是：将Unicode的双字节编码，纳入到UCS编码规范的0组0面。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UCS-4的0组0面也称为基本多语言平面（Basic MultiLanguage Plain）也就是说UCS-4的高2字节都为的时候称为BMP，BMP和UCS-4的转换也很简单，在BMP的高位添加两个字节的0就称为UCS-4，将UCS-4的高二字节都变成0就变成了BMP。
#### UTF
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;有人统计过UCS-4编码所有字符都采用4字节编码，大约浪费了40%的空间。UCS-2又不足以表示出所有现在可见的字符，所有Unicode组织，在具体的字符转码的实现上，提出了一种名叫UTF（Unicode Transform Format），所以就有了以下几种UTF转换方式
##### UTF-1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;单字节转码方式，适合将Unicode转换成ASCII编码，听说的人应该都比较少了
##### UTF-16
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UTF-16是一种变长编码，对于一个Unicode字符被编码成1至2个码元，每个码元为8位（即两字节）。范围是U+0000到U+10FFFF。对于大多数的基本文字，utf16都可以使用2个字节进行表示，所以有利于文本的处理。不过由于最小码元为两个字节，所以不兼容ASCII编码。在传输和存储时，需要考虑字节序，所以操作比较不方便。
##### UTF-32
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;四字节编码和UCS-4完全兼容，因为太浪费空间所以基本没人使用。
##### UTF-8   
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;上面的几种UTF转码方式，都有一定的问题，所以都没法大规模推广。也就出现了现在最为经典的转码方式UTF-8，他有以下的有点：
- 可以表示现有Unicode的所有已经表示的字符。
- 采用变长方式（美国字符采用一个字节表示，欧洲字符采用两个字节表示，亚洲字符采用2-3个字节表示）节省空间。
- 数据出错，影响比较小。比如在UTF-16的编码中，如果第一个字节在某种情况之下，却是了一个位，那么，后面的所有字符都会错一位，而UTF-8采用了良好的格式，最多只会影响一个字符。后面会详细分析。
**UTF-8编码的详细规则：**
```
                  1 单字节编码以0开始，完全兼容ASCII
                  2 n(n>1)字节编码，第一个字节前n位为1，第n+1位为0，从第二个字节开始第一位固定为1,第二位固定为0。
```
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;下面是网上对UTF-8编码的经典理解图（图中一个字符最长可以表示为4个字节，但是实际上还可以用5个字节，或者6个字节来进行编码，原理都是一样的）
```
0000 0000-0000 007F | 0xxxxxxx   单字节编码，总共有7位可以用来进行字符编码  
0000 0080-0000 07FF | 110xxxxx 10xxxxxx 双字节编码，总共有11位可以用来进行字符编码  
0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx 三字节编码，总共有15位可以用来进行编码  
0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx  四字节，总共有21位可以用来进行编码  
```
